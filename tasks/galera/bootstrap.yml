---
- set_fact:
    booboo: "{{ mysql_datadir }}/.ansible_galera_boostrap"

- name: STAT | Bootstrap mark
  stat: path={{ booboo }}
  register: s

- block:

    - name: SERVICE | Stop MariaDB
      service: name=mysql state=stopped

    - name: COMMAND | Bootstrap first node (systemd)
      command: galera_new_cluster
      when: ansible_service_mgr == 'systemd'

    - name: COMMAND | Bootstrap first node (clean init)
      command: '/etc/init.d/mysql bootstrap'
      register: bootstrap_run
      when: ansible_service_mgr != 'systemd'

  when: not s.stat.exists

- name: COMMAND | Create Bootstrap mark
  command: "touch {{ booboo }}"
  args:
    creates: "{{ booboo }}"
